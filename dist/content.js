function d(t){const n=t.findIndex(o=>o.text.toLowerCase().includes("booster display"));if(n!==-1)return n;const e=t.findIndex(o=>o.text.toLowerCase().includes("24 packs"));return e!==-1?e:t.length-1}function b(){const t=document.querySelectorAll("select");for(const n of t){const e=Array.from(n.options);if(e.length<=1)continue;const o=e.map(u=>({text:u.text,select:()=>{n.value=u.value,n.dispatchEvent(new Event("change",{bubbles:!0}))}})),r=d(o);if(r>=0)return o[r].select(),!0}return!1}function m(){const t=document.querySelectorAll('input[type="radio"]');if(t.length===0)return!1;const n=new Map;t.forEach(e=>{const o=e,r=o.name||"default";n.has(r)||n.set(r,[]),n.get(r).push(o)});for(const[,e]of n){if(e.length<=1)continue;const o=e.map(u=>{var l;const c=document.querySelector(`label[for="${u.id}"]`)||u.closest("label");return{text:((l=c==null?void 0:c.textContent)==null?void 0:l.trim())||u.value||"",select:()=>{u.click()}}}),r=d(o);if(r>=0)return o[r].select(),!0}return!1}function y(){return!!(b()||m())}function f(t){const n=["mousedown","mouseup","click"];for(const e of n){const o=new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,button:0,buttons:e==="mousedown"?1:0});t.dispatchEvent(o)}}function p(){var o;const t=document.querySelector('button[aria-label*="ncrement" i]');if(t)return t;const n=document.querySelectorAll("button");for(const r of n){const u=r.querySelector("svg");if(u){const c=((o=u.querySelector("path"))==null?void 0:o.getAttribute("d"))||"";if(c.includes("v")&&c.includes("h")&&c.includes("V")&&c.includes("H"))return r}}const e=document.querySelector('[role="spinbutton"]');if(e){const r=e.parentElement;if(r){const u=r.querySelectorAll("button");if(u.length>=2)return u[u.length-1]}}return null}function i(){var e;const t=document.querySelector('[role="spinbutton"]');if(t){const o=t.getAttribute("aria-valuenow");if(o)return parseInt(o,10)||1;const r=(e=t.textContent)==null?void 0:e.trim();if(r)return parseInt(r,10)||1}const n=document.querySelector('input[type="number"]');return n&&parseInt(n.value,10)||1}async function w(t,n=500){const e=Date.now();for(;Date.now()-e<n;){const o=i();if(o>=t)return o;await new Promise(r=>setTimeout(r,50))}return i()}async function g(t){if(t<=1)return!0;const n=p();if(!n)return!1;let e=i();const o=t*2;let r=0;for(;e<t&&r<o;){const u=e+1;f(n),e=await w(u,500),r++}return e>=t}async function x(){return new Promise(t=>{chrome.storage.sync.get("monitor_config",n=>{const e=n.monitor_config;t((e==null?void 0:e.quantity)||1)})})}function a(){var u;const t=document.querySelector('button[data-action*="addToCart"]');if(t)return t;const n=document.querySelector('button[data-dd-action-name="add-to-cart"]');if(n)return n;const e=document.querySelector("button.btn-fill-primary-lg");if(e)return e;const o=document.querySelector("button.cart-button");if(o)return o;const r=document.querySelectorAll("button");for(const c of r){const s=((u=c.textContent)==null?void 0:u.toLowerCase())||"";if(s.includes("add to cart")||s.includes("out of stock"))return c}return null}function h(){var e,o,r;const t=((o=(e=document.body)==null?void 0:e.innerText)==null?void 0:o.toLowerCase())||"";if(t.includes("404")||t.includes("page not found"))return"not_found";const n=a();if(n){const u=((r=n.textContent)==null?void 0:r.toLowerCase())||"";return n.disabled||n.getAttribute("aria-disabled")==="true"||u.includes("out of stock")||u.includes("sold out")?"out_of_stock":"available"}return t.includes("out of stock")||t.includes("sold out")?"out_of_stock":"not_found"}function S(){var n,e;const t=((e=(n=document.body)==null?void 0:n.innerText)==null?void 0:e.toLowerCase())||"";return a()?!0:t.includes("404")||t.includes("page not found")||t.includes("out of stock")||t.includes("sold out")}function v(t,n){return new Promise(e=>{const o=Date.now(),r=()=>{if(S()||Date.now()-o>=t){e();return}setTimeout(r,n)};r()})}function C(){const t=a();if(!t)return"button_not_found";if(t.disabled||t.getAttribute("aria-disabled")==="true")return"click_failed";try{return f(t),"clicked"}catch{return"click_failed"}}async function k(){await v(5e3,500);const t=h();let n;if(t==="available"){y()&&await new Promise(r=>setTimeout(r,200));const o=await x();o>1&&(await g(o),await new Promise(r=>setTimeout(r,200))),n=C()}chrome.runtime.sendMessage({type:"PAGE_STATUS",status:t,clickResult:n})}k();
